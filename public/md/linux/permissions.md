# 권한 관리

## 1. 파일 및 디렉토리 권한 개요

Linux는 파일 및 디렉토리에 대한 접근을 엄격하게 제어합니다. 각 파일과 디렉토리에는 소유자(User), 그룹(Group), 그리고 기타 사용자(Others)에 대한 읽기(Read), 쓰기(Write), 실행(Execute) 권한이 부여됩니다.

### 권한의 종류
- **읽기 (Read, `r`)**:
    - 파일: 파일 내용을 읽을 수 있습니다.
    - 디렉토리: 디렉토리 내의 파일 목록을 볼 수 있습니다.
- **쓰기 (Write, `w`)**:
    - 파일: 파일 내용을 수정하거나 삭제할 수 있습니다.
    - 디렉토리: 디렉토리 내에 파일을 생성, 삭제, 이름을 변경할 수 있습니다.
- **실행 (Execute, `x`)**:
    - 파일: 파일을 프로그램으로 실행할 수 있습니다.
    - 디렉토리: 디렉토리 안으로 이동(`cd`)하거나, 디렉토리 내의 파일에 접근할 수 있습니다. (디렉토리의 `x` 권한이 없으면 `ls`는 가능해도 `cd`는 불가능)

### 권한 표시 방식
`ls -l` 명령어를 사용하면 파일의 권한을 확인할 수 있습니다.
예시: `-rwxr-xr--`

이 문자열은 10개의 문자로 구성됩니다.
1. **첫 번째 문자**: 파일의 종류를 나타냅니다.
    - `-`: 일반 파일
    - `d`: 디렉토리
    - `l`: 심볼릭 링크
    - `c`: 문자 장치 파일
    - `b`: 블록 장치 파일
2. **다음 9개 문자**: 세 묶음으로 나뉘어 각각 소유자, 그룹, 기타 사용자의 권한을 나타냅니다.
    - `rwx`: 소유자 권한 (읽기, 쓰기, 실행)
    - `r-x`: 그룹 권한 (읽기, 실행, 쓰기 없음)
    - `r--`: 기타 사용자 권한 (읽기, 쓰기 및 실행 없음)

## 2. 권한 변경 명령어: `chmod`

`chmod` (change mode) 명령어는 파일 및 디렉토리의 권한을 변경하는 데 사용됩니다. 권한 변경 방법은 크게 두 가지가 있습니다.

### 1) 심볼릭 모드 (Symbolic Mode)
`u` (user, 소유자), `g` (group, 그룹), `o` (others, 기타 사용자), `a` (all, 모두)와 `+` (추가), `-` (제거), `=` (설정) 연산자를 사용하여 권한을 변경합니다.

- `chmod u+x [파일명]`: 소유자에게 실행 권한을 추가합니다.
- `chmod g-w [파일명]`: 그룹에게 쓰기 권한을 제거합니다.
- `chmod o=r [파일명]`: 기타 사용자에게 읽기 권한만 부여합니다.
- `chmod a+rw [파일명]`: 모든 사용자에게 읽기 및 쓰기 권한을 추가합니다.
- `chmod +x [파일명]`: 모든 사용자에게 실행 권한을 추가합니다. (기본적으로 `a`와 동일)

### 2) 숫자 모드 (Numeric Mode / Octal Mode)
각 권한에 숫자를 부여하여 합산하는 방식입니다.
- `r` (읽기): 4
- `w` (쓰기): 2
- `x` (실행): 1

세 자리 숫자로 권한을 표현합니다. 첫 번째 숫자는 소유자, 두 번째는 그룹, 세 번째는 기타 사용자의 권한 합계입니다.

| 권한 | r | w | x | 합계 |
|---|---|---|---|---|
| 읽기 | 4 | 0 | 0 | 4 |
| 쓰기 | 0 | 2 | 0 | 2 |
| 실행 | 0 | 0 | 1 | 1 |

**일반적인 권한 조합:**
- `777` (rwxrwxrwx): 모든 사용자에게 모든 권한 부여 (매우 위험, 특별한 경우에만 사용)
- `755` (rwxr-xr-x): 소유자는 모든 권한, 그룹과 기타 사용자는 읽기 및 실행 권한 (실행 파일, 디렉토리)
- `644` (rw-r--r--): 소유자는 읽기/쓰기, 그룹과 기타 사용자는 읽기 권한 (일반 파일)

**예시:**
- `chmod 755 [파일명]`: 소유자 rwx, 그룹 r-x, 기타 r-x
- `chmod 644 [파일명]`: 소유자 rw-, 그룹 r--, 기타 r--

## 3. 소유자 및 그룹 변경 명령어

### `chown` (change owner)
파일 또는 디렉토리의 소유자를 변경합니다.
- `chown [새소유자] [파일명]`: 파일의 소유자를 변경합니다.
- `chown [새소유자]:[새그룹] [파일명]`: 파일의 소유자와 그룹을 동시에 변경합니다.
- `chown -R [새소유자] [디렉토리명]`: 디렉토리와 그 하위 파일/디렉토리의 소유자를 재귀적으로 변경합니다.

### `chgrp` (change group)
파일 또는 디렉토리의 그룹을 변경합니다.
- `chgrp [새그룹] [파일명]`: 파일의 그룹을 변경합니다.
- `chgrp -R [새그룹] [디렉토리명]`: 디렉토리와 그 하위 파일/디렉토리의 그룹을 재귀적으로 변경합니다.

## 4. 특수 권한 (SetUID, SetGID, Sticky Bit)

### SetUID (SUID)
실행 파일에 설정되면, 해당 파일을 실행하는 사용자는 파일 소유자의 권한으로 실행됩니다. 이는 일반 사용자가 특정 시스템 파일을 수정할 수 있도록 허용하는 등 특정한 경우에 사용됩니다.
- **예시**: `passwd` 명령어는 일반 사용자가 자신의 비밀번호를 변경할 수 있도록 허용합니다. `passwd` 파일의 소유자는 `root`이고 SetUID 비트가 설정되어 있어, 일반 사용자가 `passwd`를 실행하면 일시적으로 `root` 권한으로 실행되어 `/etc/shadow` 파일을 수정할 수 있게 됩니다.
```bash
$ ls -l /usr/bin/passwd
-rwsr-xr-x 1 root root 68208 Mar 10  2023 /usr/bin/passwd
```
위 출력에서 `rws`의 `s`가 SetUID 비트가 설정되었음을 나타냅니다.

- 숫자 모드: 4000 (예: `chmod 4755 [파일명]`)
- 심볼릭 모드: `u+s` (예: `chmod u+s [파일명]`)
- `ls -l` 출력 시 소유자 실행 권한 위치에 `s`로 표시됩니다. (`-rwsr-xr-x`)

### SetGID (SGID)
- **실행 파일**: SetUID와 유사하게, 파일을 실행하는 사용자는 파일 그룹의 권한으로 실행됩니다.
- **디렉토리**: 디렉토리에 SetGID가 설정되면, 해당 디렉토리 내에 생성되는 모든 파일과 서브디렉토리는 해당 디렉토리의 그룹을 상속받습니다. 이는 여러 사용자가 특정 디렉토리에서 협업할 때 유용합니다.
- **예시**: 여러 개발자가 `project_data` 디렉토리에서 함께 작업한다고 가정해봅시다. 이 디렉토리에 SetGID를 설정하면, 어떤 사용자가 파일을 생성하든 해당 파일의 그룹은 `project_data` 디렉토리의 그룹을 따르게 되어 그룹 멤버들이 쉽게 파일에 접근하고 수정할 수 있습니다.
```bash
# project_data 디렉토리 생성 및 그룹 설정
$ sudo mkdir /shared/project_data
$ sudo chgrp developers /shared/project_data
$ sudo chmod 2775 /shared/project_data

# SetGID 설정 확인
$ ls -ld /shared/project_data
drwxrwsr-x 2 user1 developers 4096 Jul 28 10:00 /shared/project_data
```
위 출력에서 `rws`의 `s`가 SetGID 비트가 설정되었음을 나타냅니다.

- 숫자 모드: 2000 (예: `chmod 2755 [디렉토리명]`)
- 심볼릭 모드: `g+s` (예: `chmod g+s [디렉토리명]`)
- `ls -l` 출력 시 그룹 실행 권한 위치에 `s`로 표시됩니다. (`-rwxr-sr-x`)

### Sticky Bit
디렉토리에 설정되며, 해당 디렉토리 내의 파일은 소유자 또는 root만 삭제하거나 이름을 변경할 수 있습니다. 이는 여러 사용자가 파일을 생성할 수 있는 공유 디렉토리에서 다른 사용자의 파일을 함부로 삭제하는 것을 방지합니다.
- **예시**: `/tmp` 디렉토리는 모든 사용자가 파일을 생성할 수 있는 임시 디렉토리입니다. Sticky Bit가 설정되어 있어, 사용자는 자신이 생성한 파일만 삭제할 수 있고 다른 사용자가 생성한 파일은 삭제할 수 없습니다.
```bash
$ ls -ld /tmp
drwxrwxrwt 10 root root 4096 Jul 28 10:00 /tmp
```
위 출력에서 `rwt`의 `t`가 Sticky Bit가 설정되었음을 나타냅니다.

- 숫자 모드: 1000 (예: `chmod 1777 [디렉토리명]`)
- 심볼릭 모드: `o+t` (예: `chmod o+t [디렉토리명]`)
- `ls -l` 출력 시 기타 사용자 실행 권한 위치에 `t`로 표시됩니다. (`drwxrwxrwt`)

권한 관리는 Linux 시스템의 보안과 안정성에 매우 중요합니다. 적절한 권한 설정을 통해 불필요한 접근을 막고 시스템을 안전하게 유지해야 합니다.
[AD]