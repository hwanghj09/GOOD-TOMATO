# Cron 작업

Cron은 Linux/Unix 시스템에서 특정 작업을 주기적으로 자동 실행하도록 예약하는 데 사용되는 스케줄러입니다. 시스템 관리, 백업, 로그 정리 등 반복적인 작업을 자동화하는 데 매우 유용합니다.

## 1. Cron의 기본 개념

- **Cron 데몬**: `crond`라는 백그라운드 프로세스가 주기적으로 실행되어 예약된 작업을 확인하고 실행합니다.
- **Crontab (Cron Table)**: Cron 작업의 예약 정보를 담고 있는 파일입니다. 각 사용자마다 자신의 crontab 파일을 가질 수 있습니다.
- **작업 예약 형식**: Crontab 파일은 특정 형식에 따라 작업을 예약합니다.

## 2. Crontab 형식

Crontab의 각 줄은 하나의 작업을 나타내며, 다음과 같은 6개의 필드로 구성됩니다.

```
분(0-59) 시(0-23) 일(1-31) 월(1-12) 요일(0-7) 실행할_명령어
```

- **분**: 0부터 59까지의 숫자
- **시**: 0부터 23까지의 숫자 (0은 자정)
- **일**: 1부터 31까지의 숫자
- **월**: 1부터 12까지의 숫자 또는 월의 약어(Jan, Feb 등)
- **요일**: 0부터 7까지의 숫자 (0 또는 7은 일요일, 1은 월요일, 6은 토요일)

### 특수 문자
- `*`: 모든 시간 단위 (예: `*` 분은 매 분마다)
- `,`: 여러 값 지정 (예: `1,15` 분은 1분과 15분)
- `-`: 범위 지정 (예: `9-17` 시는 오전 9시부터 오후 5시까지)
- `/`: 간격 지정 (예: `*/5` 분은 5분마다)

### 예시
- `0 0 * * * /path/to/daily_backup.sh`: 매일 자정(0시 0분)에 `daily_backup.sh` 스크립트 실행
- `*/10 * * * * /usr/bin/php /var/www/html/cron.php`: 매 10분마다 PHP 스크립트 실행
- `0 2 * * 1 /sbin/reboot`: 매주 월요일 새벽 2시에 시스템 재부팅
- `30 8 1 * * /home/user/monthly_report.sh`: 매월 1일 오전 8시 30분에 `monthly_report.sh` 스크립트 실행

## 3. Crontab 명령어

### 1) Crontab 편집: `crontab -e`

현재 사용자의 crontab 파일을 편집합니다. 처음 실행하면 기본 텍스트 에디터(vi 또는 nano)가 열립니다.
- `crontab -e`: 현재 사용자의 crontab 파일을 엽니다.
    - **예시**: `crontab -e` (현재 사용자의 크론탭 편집기를 엽니다. 처음 실행 시 에디터 선택 프롬프트가 나타날 수 있습니다.)

### 2) Crontab 목록 확인: `crontab -l`

현재 사용자의 crontab에 등록된 작업 목록을 출력합니다.
- `crontab -l`: 등록된 작업 목록을 보여줍니다.
    - **예시**: `crontab -l` (현재 등록된 크론 작업 목록을 확인합니다.)

### 3) Crontab 삭제: `crontab -r`

현재 사용자의 crontab 파일을 완전히 삭제합니다. (주의: 복구 불가능)
- `crontab -r`: crontab 파일을 삭제합니다.
    - **예시**: `crontab -r` (현재 사용자의 모든 크론 작업을 삭제합니다. 신중하게 사용해야 합니다.)
- `crontab -i`: 삭제 전에 확인 메시지를 표시합니다.
    - **예시**: `crontab -i` (삭제 전 확인 메시지를 통해 실수 방지)

### 4) 다른 사용자의 Crontab 관리 (root 권한)

root 사용자는 `-u` 옵션을 사용하여 다른 사용자의 crontab을 관리할 수 있습니다.
- `sudo crontab -e -u [사용자명]`: 특정 사용자의 crontab 편집
    - **예시**: `sudo crontab -e -u webuser` (`webuser`의 크론탭을 편집합니다.)
- `sudo crontab -l -u [사용자명]`: 특정 사용자의 crontab 목록 확인
    - **예시**: `sudo crontab -l -u webuser` (`webuser`의 크론탭 목록을 확인합니다.)

## 4. Cron 작업 시 주의사항

- **환경 변수**: Crontab 환경에서는 일반 쉘 환경과 달리 환경 변수가 제한적일 수 있습니다. 스크립트 내에서 필요한 환경 변수를 명시적으로 설정하거나, 명령어의 절대 경로를 사용하는 것이 좋습니다.
    - 예: `PATH=/usr/local/bin:/usr/bin:/bin`
- **로그 확인**: Cron 작업이 제대로 실행되는지 확인하기 위해 로그 파일을 주기적으로 확인해야 합니다.
    - 시스템 로그: `/var/log/syslog` 또는 `/var/log/cron` (배포판에 따라 다름)
    - 스크립트 내에서 표준 출력/에러를 파일로 리다이렉션하여 로그를 남기는 것이 좋습니다.
        - `0 0 * * * /path/to/script.sh >> /var/log/script.log 2>&1`
- **권한**: Cron 작업은 해당 crontab을 소유한 사용자의 권한으로 실행됩니다. 필요한 권한이 있는지 확인해야 합니다.
- **최소 시간 단위**: Cron은 분 단위로만 예약할 수 있습니다. 초 단위의 정밀한 스케줄링이 필요하면 다른 도구(예: `systemd.timer`)를 고려해야 합니다.

Cron은 Linux 시스템 관리에서 매우 강력한 자동화 도구입니다. 정확한 예약 형식과 주의사항을 이해하고 활용하면 시스템 운영의 효율성을 크게 높일 수.
[AD]